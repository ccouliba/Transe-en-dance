<!DOCTYPE html>
<html lang="en">
  <head>
	<meta charset="UTF-8" />
	<title>{% block title %}PONG{% endblock %}</title>
	{% load static %}
	<link rel="stylesheet" href="{% static 'pong/css/style.css' %}" />
	<link rel="icon" href="{% static 'pong/images/favicon.ico' %}" type="image/x-icon">
  </head>
  <body>
	<header>
		<h1 class="pong-title">PONG</h1>
		<div id="menu-container"></div>
	</header>
	<script src="{% static 'pong/js/menu.js' %}"></script>
	<script src="{% static 'pong/js/home.js' %}"></script>
	<script src="{% static 'pong/js/play/play.js' %}"></script>
	<script src="{% static 'pong/js/play/pongGame.js' %}"></script>
	<script src="{% static 'pong/js/friends.js' %}"></script>
	<script src="{% static 'pong/js/tournament/tournament.js' %}"></script>
   
	<script src="{% static 'pong/js/tournament/tournamentDetail.js' %}"></script>
	<script src="{% static 'pong/js/tournament/matchmaking.js' %}"></script>
	<script src="{% static 'pong/js/logout.js' %}"></script>
	<script src="{% static 'pong/js/404.js' %}"></script>
	<script src="{% static 'pong/js/profile.js' %}"></script>
	<script src="{% static 'pong/js/login.js' %}"></script>
	<script src="{% static 'pong/js/register.js' %}"></script>
	<script src="{% static 'pong/js/main.js' %}"></script>
	<script src="{% static 'pong/js/matchHistory.js' %}"></script>
	<!-- <p><script src="{% static 'pong/js/iaAlgo.js' %}"></script></p> -->
	<main>
	  <div id="app">
		{% block content %}
		<script>

			/*
			let hash = window.location.hash
		   
			changePage(hash);
			*/

			{% if user.is_authenticated %}
				if (window.location.hash === '' || window.location.hash === '#') {
					changePage('#home');
				} else {
					changePage(window.location.hash);
				}
			{% else %}
				if (window.location.hash === '#register') {
					changePage('#register');
				} else {
					changePage('#login');
				}
			{% endif %}
		</script>
		{% endblock %}
	  </div>
	</main>
	{% block scripts %} {% endblock %}


	
	<script>

	// Script JS pour avoir une modale lorsque l'utilisateur est en mode navigation privee


	// VerifiFonction pour verifier si l'utilisateur est en mode navigation privee
	async function isIncognito() {
		if (navigator.storage && navigator.storage.estimate) {
			const { quota } = await navigator.storage.estimate();
			if (quota) {
				return quota < performance.memory.jsHeapSizeLimit;
			}
		}
		return false;
	}

	// Fonction pour afficher la modale
	function showModal() {
		// Verifier si l'utilisateur a deja accepte les conditions
		if (localStorage.getItem('incognitoAccepted') === 'true') return;

		const modal = document.createElement('div');
		modal.style.cssText = `
			position: fixed;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			background-color: white;
			padding: 20px;
			border-radius: 5px;
			box-shadow: 0 0 10px rgba(0,0,0,0.3);
			z-index: 1000;
			max-width: 80%;
			max-height: 80%;
			overflow-y: auto;
		`;
		modal.innerHTML = `
			   <h2>Warning</h2>
				<p>You are currently using private browsing mode. Please be aware of the following:</p>
				<ul>
					<li>If you close your window or your tab, you will be logged out, but you may still appear active to your friends.</li>
					<li>To appear offline to your friends, you must manually log out before closing the window.</li>
				</ul>

			<button id="acceptIncognito" style="
				background-color: #4CAF50;
				border: none;
				color: white;
				padding: 15px 32px;
				text-align: center;
				text-decoration: none;
				display: inline-block;
				font-size: 16px;
				margin: 4px 2px;
				cursor: pointer;
			">I understand and accept the consequences</button>
		`;
		document.body.appendChild(modal);

		// Ajouter un event au bouton
		document.getElementById('acceptIncognito').addEventListener('click', function() {
			localStorage.setItem('incognitoAccepted', 'true');
			modal.remove();
		});
	}

	// Verifier si l'utilisateur est en mode de navigation privee et afficher la modale 
	isIncognito().then(incognito => {
		if (incognito) {
			showModal();
		}
	});

		</script>
















  </body>
</html>

